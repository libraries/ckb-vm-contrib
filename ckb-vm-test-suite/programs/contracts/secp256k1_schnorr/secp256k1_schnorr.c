#include <stdlib.h>

#include "secp256k1_extrakeys.h"
#include "secp256k1_schnorrsig.h"
#include "secp256k1.h"

int execute() {
    const unsigned char sig[64] = {
        0x52, 0x42, 0x0f, 0xa2, 0x80, 0x7e, 0xac, 0x73, 0x36, 0xc1, 0x5e, 0xc7, 0xdb, 0x76, 0xb4, 0x1c,
        0x32, 0x47, 0xf8, 0x45, 0x7a, 0x15, 0x33, 0xbd, 0x78, 0x33, 0x78, 0xe5, 0x63, 0xcb, 0x33, 0xc4,
        0x3e, 0x5a, 0x8b, 0x17, 0xe9, 0x1b, 0xad, 0xaa, 0x29, 0x0c, 0x02, 0xd3, 0xf8, 0xce, 0x50, 0xdf,
        0x13, 0x0c, 0x9d, 0x09, 0xc9, 0x0c, 0x28, 0x8d, 0x9d, 0x2b, 0xe0, 0xe5, 0x97, 0x6a, 0x53, 0x54,
    };
    const unsigned char msg[32] = {
        0x1b, 0xd6, 0x9c, 0x07, 0x5d, 0xd7, 0xb7, 0x8c, 0x4f, 0x20, 0xa6, 0x98, 0xb2, 0x2a, 0x3f, 0xb9,
        0xd7, 0x46, 0x15, 0x25, 0xc3, 0x98, 0x27, 0xd6, 0xaa, 0xf7, 0xa1, 0x62, 0x8b, 0xe0, 0xa2, 0x83,
    };
    const unsigned char pubkey_raw[32] = {
        0x25, 0x04, 0xea, 0x57, 0x63, 0xb6, 0xd7, 0xa5, 0x1b, 0x50, 0xdb, 0xf5, 0x87, 0x1e, 0x50, 0xf1,
        0x95, 0xb3, 0xe0, 0x29, 0x7f, 0xe6, 0x27, 0x23, 0x34, 0xbe, 0x55, 0x5d, 0x3e, 0x52, 0x31, 0xa6,
    };

    secp256k1_context* ctx = secp256k1_context_create(SECP256K1_CONTEXT_NONE);
    secp256k1_xonly_pubkey pubkey;
    if (!secp256k1_xonly_pubkey_parse(ctx, &pubkey, pubkey_raw)) {
        return 1;
    }
    int result = secp256k1_schnorrsig_verify(ctx, sig, msg, 32, &pubkey);
    if (result != 1) {
        return 1;
    }
    return 0;
}

int main(int argc, char* argv[]) {
#if defined(__riscv)
    int n = argc > 0 ? atoi(argv[0]) : 1;
#else
    int n = argc > 1 ? atoi(argv[1]) : 1;
#endif
    for (int i = 0; i < n; i++) {
        int r = execute();
        if (r != 0) {
            return r;
        }
    }
    return 0;
}
